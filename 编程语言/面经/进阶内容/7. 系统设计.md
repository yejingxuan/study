
# 系统设计

## 一、微服务设计

### 1.1、微服务的核心思想
- 独立性：
  - 各个服务可以独立部署，不依赖其他服务的模块
- 单一职责
  - 只做某一模块的事情
- 轻量级通信
  - 远程调用rpc，快速通信，负载均衡
- 隔离性
  - 保证每个服务有自己独立的数据源，其他服务只能通过接口调用的形式来操作其他服务的数据源

### 1.2、eureka服务注册发现
- __服务注册__
  - 服务启动后注册到eureka当中，eureka维护一个服务注册表，

- __服务下线__
  - x

- __服务状态更新__
  - 每个服务默认30秒发送一个心跳包来保证自己在eureka中的连接状态
  - eureka默认每隔60秒把服务注册表中超时续约（默认90秒）的服务剔除出去
![](https://gitee.com/jingxuanye/yjx-pictures/raw/master/pic/20200702211216.png)

- __自我保护__


### 1.3、hystrix服务容错保护

- hystrix的两种模式
  - 线程池隔离模式：
    - 使用一个线程池来存储当前的请求，线程池对请求作处理，设置任务返回处理超时时间，堆积的请求堆积入线程池队列。这种方式需要为每个依赖的服务申请线程池，有一定的资源消耗，好处是可以应对突发流量（流量洪峰来临时，处理不完可将数据存储到线程池队里慢慢处理）。
  - 信号量隔离模式
    - 使用一个原子计数器（或信号量）来记录当前有多少个线程在运行，请求来先判断计数器的数值，若超过设置的最大线程个数则丢弃改类型的新请求，若不超过则执行计数操作请求来计数器+1，请求返回计数器-1。这种方式是严格的控制线程且立即返回模式，无法应对突发流量（流量洪峰来临时，处理的线程超过数量，其他的请求会直接返回，不继续去请求依赖的服务）



### 1.4、ribbon、feign远程服务调用和负载均衡
- __调用流程__
  - 注册成功的服务会每隔30秒（可配置）从eureka中拉取服务注册表，ribbon/feign调用其他服务的时候，会根据服务注册表里的相关服务进行请求访问，
- __负载均衡__
  - 默认采用轮询的方法进行负载均衡，当然也可以实现自己定义的负载均衡器
  - RandomRule:随机  RoundRobinRule:线性轮询方式  WeightedResponseTimeRule:权重
  - 


### 1.5、zuul && gateway网关服务


### 1.6、springcloud-config

### 1.7、sleuth、zipkin分布式服务追踪





## 二、中台思想

### 2.1、技术中台

### 2.2、数据中台

### 2.3、业务中台


## 三、领域驱动设计（Domain Driven Design）



## 参考文章

- [100并发 -> 千万并发，阿里淘宝的 14 次架构演进之路！](https://juejin.im/post/5d03ae395188252c023fafea)
- [一个微服务+DDD(领域驱动设计)的代码结构示例](https://blog.csdn.net/weixin_30347009/article/details/95899528?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase)
  - [项目源码](https://github.com/EalenXie/springcloud-microservice-ddd)
- [Spring Cloud原理详解](https://blog.csdn.net/qq_41701956/article/details/83829539)