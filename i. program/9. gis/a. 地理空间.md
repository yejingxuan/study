# postgis

- [postgis](#postgis)
  - [一、基础](#一基础)
    - [1、名词解释](#1名词解释)
    - [2、各级比例尺及空间分辨率列表](#2各级比例尺及空间分辨率列表)
  - [二、数据转换](#二数据转换)
    - [1、geometry转换](#1geometry转换)
    - [2、几何转换](#2几何转换)
  - [三、坐标系](#三坐标系)
    - [1、坐标系简介](#1坐标系简介)
    - [2、坐标系转换](#2坐标系转换)
  - [四、空间数据处理](#四空间数据处理)
    - [1、测试几何图形内部是否相交](#1测试几何图形内部是否相交)
  - [参考文章](#参考文章)

## 一、基础
### 1、名词解释
- srid：坐标系
- geometry：空间几何
- geojson：一种基于JSON的地理空间数据交换格式

### 2、各级比例尺及空间分辨率列表
|  级别  | 实际距离 | 像素 | 图上距离 | 图像分辨率 |   比例尺    | 空间分辨率 |
| :----: | :------: | :--: | :------: | :--------: | :---------: | :--------: |
| 第1级  | 10000公里 |    |  |       |      |      |
| 第2级  | 5000公里 |  70  | 2.47厘米 |   72dpi    |   2亿 ：1   |   71公里   |
| 第3级  | 2000公里 |  55  | 1.94厘米 |   72dpi    |   1亿 ：1   |   36公里   |
| 第4级  | 2000公里 | 115  | 4.06厘米 |   72dpi    |  5千万 ：1  |   17公里   |
| 第5级  | 1000公里 | 115  | 4.06厘米 |   72dpi    | 2.5千万 ：1 |   9公里    |
| 第6级  | 500公里  | 115  | 4.06厘米 |   72dpi    | 1.2千万 ：1 |   4公里    |
| 第7级  | 200公里  |  91  | 3.21厘米 |   72dpi    |  6百万 ：1  |   2公里    |
| 第8级  | 100公里  | 176  | 6.21厘米 |   72dpi    |  160万 ：1  |   568米    |
| 第9级  |  50公里  |  91  | 3.21厘米 |   72dpi    |  155万 ：1  |   549米    |
| 第10级 |  20公里  |  72  | 2.54厘米 |   72dpi    |  80万 ：1   |   278米    |
| 第11级 |  10公里  |  72  | 2.54厘米 |   72dpi    |  40万 ：1   |   139米    |
| 第12级 |  5公里   |  72  | 2.54厘米 |   72dpi    |  20万 ：1   |    69米    |
| 第13级 |  2公里   |  57  | 2.01厘米 |   72dpi    |  10万 ：1   |    35米    |
| 第14级 |  2公里   | 118  | 4.16厘米 |   72dpi    |   5万 ：1   |    17米    |
| 第15级 |  1公里   | 118  | 4.16厘米 |   72dpi    |  2.5万 ：1  |    8米     |
| 第16级 |  500米   | 118  | 4.16厘米 |   72dpi    |  1.2万 ：1  |    4米     |
| 第17级 |  200米   |  93  | 3.28厘米 |   72dpi    |  2300 ：1   |   2.15米   |
| 第18级 |  100米   |  93  | 3.28厘米 |   72dpi    |  3000 : 1   |   1.07米   |
| 第19级 |   50米   |  93  | 3.28厘米 |   72dpi    |  1500 : 1   |   0.54米   |
| 第20级 |   20米   |  74  | 2.61厘米 |   72dpi    |   800 ：1   |   0.27米   |

## 二、数据转换

### 1、geometry转换
- __st_asgeojson(geometry, int4, int4)__
  - 把 geometry 转换为 geojson 数据
  ```sql
  SELECT st_asgeojson(mgeom, 8, 8) FROM "school"
  ```

- __st_geomfromgeojson(text)__
  - 把 geojson 转换为 geometry 数据
  ```sql
  SELECT st_geomfromgeojson('{"type":"Polygon","coordinates":[[[119.34860903,35.3107758],[119.34879994,35.3097576],[119.35011587,35.31007475],[119.34987723,35.31100949],[119.34860903,35.3107758]]]}') FROM "school"
  ```

- __st_astext(geometry)__
  - 把空间数据转为文本可读形式
  ```sql
  select st_astext(ST_SetSRID (ST_Point(119.34860903,35.3107758), 4326))
  ```

### 2、几何转换
- __st_makevalid(geometry)__
  - 无效几何转为有效几何而不会丢失任何输入顶点
  ```sql
  select st_makevalid(ST_Point(119.34860903,35.3107758))
  ```

## 三、坐标系

### 1、坐标系简介
- 对于 Web Map 开发人员来说，最熟悉的应该是EPSG:4326 (WGS84) 
-  WGS84 是目前最流行的地理坐标系统。在国际上，每个坐标系统都会被分配一个 EPSG 代码，EPSG:4326 就是 WGS84 的代码。GPS是基于WGS84的，所以通常我们得到的坐标数据都是WGS84的。一般我们在存储数据时，仍然按WGS84存储。

### 2、坐标系转换
- __st_setsrid(geometry, int4)__
  - 修改空间数据，转换为指定坐标系
  ```sql
  /*转换为 4326 坐标系*/
  SELECT ST_SetSRID (ST_Point(119.34860903,35.3107758), 4326)
  ```

## 四、空间数据处理
### 1、测试几何图形内部是否相交
- __st_intersects(geometry, geometry)__
  - 判断两个空间数据之间是否相交，返回true或false
  ```sql
  SELECT * FROM "district" where st_intersects(geom, 
  st_geomfromgeojson('{"type":"Polygon","coordinates":[[[119.34860903,35.3107758],[119.34879994,35.3097576],[119.35011587,35.31007475],[119.34987723,35.31100949],[119.34860903,35.3107758]]]}'))
  ```


## 参考文章
- [GIS基础知识 - 坐标系、投影、EPSG:4326、EPSG:3857](https://www.cnblogs.com/E7868A/p/11460865.html)