[TOC]


## 高可用原则
### 1、服务降级
【目的】保证异发情况下，尽可能低的减少服务影响

降级开关集中管理：将开关配置推送至各个应用

降级开关前置化：如nginx+lua配置降级策略，引流流量

业务降级：高并发访问情况下，保证核心功能运行，次要功能可同步改异步或者屏蔽

读写降级：如调用服务降级为关闭写操作、只读本地缓存

### 2、限流
【目的】防止恶意请求攻击或者超出系统峰值

恶意请求流量只访问到cache

恶意或异常IP/用户封禁

穿透后端应用的流量使用nginx limit限速

### 3、切流量
【目的】屏蔽故障机器

DNS：更改域名解析入口，由于ttl失效时间，存在解析生效时间

HTTPDNS：绕过LocalDNS实现精准流量调度

LVS四层和Nginx/HaProxy七层负载均衡：摘除股摘除故障设备

### 4、集群化
【目的】防止单点故障

分布式部署

集群化部署

主备、热备

### 5、回滚
发布版本失效时可随时快速回滚至上一稳定版本



## 高并发原则

### 1、无状态
无状态服务：便于水平扩展

有状态服务：通过配置中心实现无状态化

eg：disconf、zk、consul等

### 2、拆分
系统维度：按系统功能、业务拆分等

功能维度：系统功能的细粒度拆分

读写维度：读多考虑多级缓存；写多考虑分库分表

模块维度：针对整体代码结构划分Web、Service、DAO

### 3、服务化
服务演进历程：进程内服务->单机远程服务->集群手动注册服务->自动注册和发现服务->服务的分组、隔离、路由->服务治理

利用Lvs/Nginx等实现负载均衡，利用zk、consul等实现自动注册和服务发现

### 4、消息队列
服务解耦、异步处理、流量消峰缓冲等

流量缓冲：牺牲强一致性，保证最终一致性

数据校验：解决异步机制下消息丢失问题

### 5、缓存
用户层：DNS缓存、客户端缓存

代理层：CDN缓存

接入层：opcache、fast cgi cache、proxy cache等

应用层：页面静态化；业务数据缓存（Redis/memcached/file）；消息队列

数据层：NoSql、MySql

系统层：CPU L1/L2/L3 cache/numa、内存、磁盘

### 6、并发